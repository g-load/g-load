<!DOCTYPE html>
<html>
<head>
<title>Real-time Acceleration Monitor</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> </head>
<body>

<h1>Real-time Acceleration (g)</h1>
<div id="accelerationValue">0.00</div>  <canvas id="accelerationChart" width="400" height="200"></canvas>

<h2>Historical Data</h2>
<input type="date" id="datePicker">
<button onclick="loadHistoricalData()">Load Data</button>
<div id="historicalData"></div>

<script>
  let accelerationValue = document.getElementById("accelerationValue");
  let accelerationChart = document.getElementById("accelerationChart").getContext('2d');
  let datePicker = document.getElementById("datePicker");
  let historicalDataDiv = document.getElementById("historicalData");

  let chart = new Chart(accelerationChart, {
    type: 'line',
    data: {
      labels: [], // Time labels
      datasets: [{
        label: 'Acceleration (g)',
        data: [], // Acceleration data
        borderColor: 'blue',
        borderWidth: 1,
        tension: 0.4 // Smooths the line
      }]
    },
    options: {
      scales: {
        x: {  // Time axis
          type: 'time', // Important for time series data
          time: {
            parser: 'seconds', // Adjust if your timestamps are in milliseconds
            unit: 'second',  // or 'minute', 'hour', etc. as needed
            displayFormats: {
              second: 'h:mm:ss a' // Customize time format
            }
          },
          title: {
            display: true,
            text: 'Indian Time (IST)'
          }
        },
        y: {
          beginAtZero: false, // Don't start y-axis at 0 if not needed
          title: {
            display: true,
            text: 'Acceleration (g)'
          }
        }
      }
    }
  });

  // Function to update the chart and acceleration value
  function updateAcceleration(time, acceleration) {
    accelerationValue.textContent = acceleration.toFixed(2); // Display with 2 decimal places

    chart.data.labels.push(time);
    chart.data.datasets[0].data.push(acceleration);

    if (chart.data.labels.length > 10) { // Keep only last 10 data points on the graph
      chart.data.labels.shift();
      chart.data.datasets[0].data.shift();
    }
    chart.update();
  }

  // Simulated data (Replace with actual data from Firebase)
  // This is how you would receive data from your ESP8266/Firebase
  // You would use a library like the Firebase JavaScript SDK to read data in real-time.

  // Example real-time data handling (replace with your Firebase setup)
  // Assuming you have a Firebase listener set up to get new acceleration data
  // and it calls a function named handleNewAccelerationData(timestamp, acceleration):

  function handleNewAccelerationData(timestamp, acceleration) {
    // Convert the Firebase timestamp (likely a number) to a Date object
    let date = new Date(timestamp * 1000); // *1000 if timestamp is in seconds
    let istTime = date.toLocaleString("en-IN", { timeZone: "Asia/Kolkata" }); // Indian Time

    updateAcceleration(istTime, acceleration);
  }


  function loadHistoricalData() {
    let selectedDate = datePicker.value;
    if (!selectedDate) {
      alert("Please select a date.");
      return;
    }

    // You would use the Firebase JavaScript SDK to fetch historical data
    // based on the selectedDate.  This is a placeholder:
    historicalDataDiv.innerHTML = "Fetching historical data for " + selectedDate + "...";

    // Example:  Replace with your Firebase data retrieval logic
    // ... (Your Firebase code to retrieve data for the selected date) ...

    // After retrieving the data, display it in the historicalDataDiv
    // Example:
    // let historicalData = "Data from Firebase for " + selectedDate + ": ...";
    // historicalDataDiv.innerHTML = historicalData;
  }

  // Initialize datepicker to today's date
  datePicker.valueAsDate = new Date();


</script>

</body>
</html>
