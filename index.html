<!DOCTYPE html>
<html>
<head>
  <title>MPU6050 Acceleration Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
  <h2>Real-Time MPU6050 Acceleration Data</h2>
  <div id="chart_div" style="width: 800px; height: 500px;"></div>
  <button onclick="downloadExcel()">Download Data</button>

  <script>
   const firebaseConfig = {
  apiKey: "AIzaSyCxrkRZ2sTwg8fivnLpzzCTLtrV3sY22wk",
  authDomain: "gload-9bbb7.firebaseapp.com",
  databaseURL: "https://gload-9bbb7-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "gload-9bbb7",
  storageBucket: "gload-9bbb7.firebasestorage.app",
  messagingSenderId: "906599077982",
  appId: "1:906599077982:web:c40399c0ff5f789abf3ccf"

};


    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("/acceleration");

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    let dataArr = [['Time', 'X-Axis (g)']];

    function drawChart() {
      var data = google.visualization.arrayToDataTable(dataArr);
      var options = { title: 'MPU6050 Acceleration', curveType: 'function', legend: { position: 'bottom' } };
      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }

    db.on("child_added", function(snapshot) {
      let timestamp = new Date(parseInt(snapshot.key)).toLocaleTimeString();
      let xAxis = snapshot.val().x;
      dataArr.push([timestamp, xAxis]);
      drawChart();
    });

    function downloadExcel() {
      let csvContent = "data:text/csv;charset=utf-8,Time,X-Axis (g)\n";
      dataArr.slice(1).forEach(row => { csvContent += row.join(",") + "\n"; });
      let encodedUri = encodeURI(csvContent);
      let link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "mpu6050_acceleration_data.csv");
      document.body.appendChild(link);
      link.click();
    }
  </script>
</body>
</html>
