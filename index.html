<!DOCTYPE html>
<html>
<head>
  <title>Real-time Acceleration Monitoring</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #acceleration {
      font-size: 20px;
      margin-top: 20px;
    }
    #chart_div {
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>
  <h2>Real-time Acceleration Monitoring</h2>
  <p id="acceleration">Loading...</p>
  <div id="chart_div"></div>
  <input type="date" id="date-input" />
  <button id="load-data-button">Load Historical Data</button>
  <div id="historical-data-div"></div>

  <script>
    // Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyDSiocR1RLgQwGzgBiKcr_W7NBJxQSbyH8",
  authDomain: "g-load-dc40b.firebaseapp.com",
  databaseURL: "https://g-load-dc40b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "g-load-dc40b",
  storageBucket: "g-load-dc40b.firebasestorage.app",
  messagingSenderId: "589491451732",
  appId: "1:589491451732:web:b36abd93b770651dfd7ac1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();

    // Google Charts setup
    google.charts.load('current', {packages: ['corechart', 'line']});
    google.charts.setOnLoadCallback(drawChart);

    var data = new google.visualization.DataTable();
    data.addColumn('datetime', 'Time');
    data.addColumn('number', 'Acceleration (g)');

    function drawChart() {
      var options = {
        title: 'Real-time Acceleration Data',
        curveType: 'function',
        legend: { position: 'bottom' },
        hAxis: { title: 'Time' },
        vAxis: { title: 'Acceleration (g)' },
        colors: ['#1b9e77']
      };

      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

      database.ref('/acceleration_data').limitToLast(20).on('value', (snapshot) => {
        data.removeRows(0, data.getNumberOfRows());
        snapshot.forEach((childSnapshot) => {
          var entry = childSnapshot.val();
          var time = new Date(entry.timestamp * 1000);
          var acceleration = entry.acceleration_g;
          data.addRow([time, acceleration]);
          document.getElementById("acceleration").innerHTML = `Latest Acceleration: <b>${acceleration} g</b> at ${time.toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata' })}`;
        });
        chart.draw(data, options);
      });
    }

    document.getElementById("load-data-button").addEventListener("click", () => {
      var dateInput = document.getElementById("date-input");
      var date = dateInput.valueAsDate;
      var timestamp = date.getTime() / 1000;
      database.ref('/acceleration_data').orderByChild("timestamp").startAt(timestamp).endAt(timestamp + 86400).on('value', (snapshot) => {
        var historicalDataDiv = document.getElementById("historical-data-div");
        historicalDataDiv.innerHTML = "";
        snapshot.forEach((childSnapshot) => {
          var entry = childSnapshot.val();
          var time = new Date(entry.timestamp * 1000);
          var acceleration = entry.acceleration_g;
          historicalDataDiv.innerHTML += `<p>Acceleration: ${acceleration} g at ${time.toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata' })}</p>`;
        });
      });
    });
  </script>
</body>
</html>
