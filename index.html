<!DOCTYPE html><html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Acceleration Data</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <h1>Real-Time Acceleration Data</h1>
    <p>Current Acceleration (X-axis): <span id="currentAcceleration">Loading...</span> g</p>
    <div id="chart_div" style="width: 100%; height: 500px;"></div>
    <button onclick="downloadCSV()">Download Data</button><script>
    // Firebase Configuration
    var firebaseConfig = {
        apiKey: "your-api-key",
        authDomain: "your-auth-domain",
        databaseURL: "your-database-url",
        projectId: "your-project-id",
        storageBucket: "your-storage-bucket",
        messagingSenderId: "your-messaging-sender-id",
        appId: "your-app-id"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.database();

    // Google Charts Initialization
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(fetchRealTimeData);

    let realTimeData;
    let realTimeChart;
    let historicalValues = [];
    let options = {
        title: 'Real-Time Acceleration (X-Axis)',
        curveType: 'function',
        legend: { position: 'bottom' },
        hAxis: { title: 'Time (IST)' },
        vAxis: { title: 'Acceleration (g)', minValue: 0 }
    };

    function fetchRealTimeData() {
        let currentTime = Math.floor(Date.now() / 1000);
        let startTime = currentTime - 86400; // Last 24 hours

        db.ref('/acceleration_data')
            .orderByChild('timestamp')
            .startAt(startTime)
            .on('value', snapshot => {
                let values = [];
                snapshot.forEach(child => {
                    let val = child.val();
                    if (val.timestamp && val.acceleration_g) {
                        values.push({
                            time: convertToIST(val.timestamp),
                            acceleration: val.acceleration_g
                        });
                    }
                });

                values.sort((a, b) => a.time - b.time);

                if (values.length > 0) {
                    document.getElementById("currentAcceleration").innerText = values[values.length - 1].acceleration.toFixed(3);
                }

                realTimeData = new google.visualization.DataTable();
                realTimeData.addColumn('datetime', 'Time (IST)');
                realTimeData.addColumn('number', 'Acceleration (g)');

                values.forEach(entry => {
                    realTimeData.addRow([entry.time, parseFloat(entry.acceleration.toFixed(3))]);
                });

                realTimeChart = new google.visualization.LineChart(document.getElementById('chart_div'));
                realTimeChart.draw(realTimeData, options);
            });
    }

    function convertToIST(timestamp) {
        let date = new Date(timestamp * 1000);
        return new Date(date.toLocaleString("en-US", { timeZone: "Asia/Kolkata" }));
    }

    function downloadCSV() {
        if (historicalValues.length === 0) {
            alert("No historical data to download. Please load historical data first.");
            return;
        }

        let csvContent = "Time (IST),Acceleration (g)\n";
        historicalValues.forEach(entry => {
            let formattedTime = entry.time.toLocaleString("en-IN", { timeZone: "Asia/Kolkata" });
            csvContent += ${formattedTime},${entry.acceleration.toFixed(3)}\n;
        });
        let blob = new Blob([csvContent], { type: "text/csv" });
        let link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = Acceleration_Data_${new Date().toISOString().slice(0, 10)}.csv;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>
